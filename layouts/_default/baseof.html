<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ .Title }}</title>
  {{ partial "head.html" . }}
  <script>
    // Apply theme before page renders to prevent flash
    (function() {
      const savedTheme = localStorage.getItem('theme');
      const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      // Default to dark mode if no preference is saved
      const theme = savedTheme !== null ? savedTheme : 'dark';
      
      if (theme === 'dark') {
        document.documentElement.classList.add('dark-theme');
      } else {
        document.documentElement.classList.remove('dark-theme');
      }
    })();
  </script>
</head>
<body>
  <div class="wrapper">
    <div class="centered-container">
      {{ partial "header.html" . }}
      <main class="content-container">
        {{ block "main" . }}{{ end }}
      </main>
      {{ partial "footer.html" . }}
    </div>
  </div>

  <!-- Dark Mode Toggle Button -->
  <button class="theme-toggle" aria-label="Toggle dark mode">
    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
    <svg class="moon-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </button>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Apply saved theme to body
      const savedTheme = localStorage.getItem('theme');
      const theme = savedTheme !== null ? savedTheme : 'dark';
      if (theme === 'dark') {
        document.body.classList.add('dark-theme');
      } else {
        document.body.classList.remove('dark-theme');
      }

      // Mobile menu toggle
      const menuIcon = document.querySelector('.icon-menu');
      const mobileNav = document.querySelector('.mobile-nav');
      const navContainer = document.querySelector('.nav');

      if (menuIcon && mobileNav && navContainer) {
        menuIcon.addEventListener('click', (event) => {
          event.stopPropagation();
          mobileNav.classList.toggle('is-visible');
          menuIcon.classList.toggle('open');
        });

        // Close menu when clicking a link
        mobileNav.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', () => {
            mobileNav.classList.remove('is-visible');
            menuIcon.classList.remove('open');
          });
        });
      }

      // Dark mode toggle
      const themeToggle = document.querySelector('.theme-toggle');
      const sunIcon = document.querySelector('.sun-icon');
      const moonIcon = document.querySelector('.moon-icon');
      
      function updateIcons() {
        const isDark = document.body.classList.contains('dark-theme');
        sunIcon.style.display = isDark ? 'none' : 'block';
        moonIcon.style.display = isDark ? 'block' : 'none';
      }

      // Initialize icons based on current theme
      updateIcons();

      themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark-theme');
        document.documentElement.classList.toggle('dark-theme');
        const isDark = document.body.classList.contains('dark-theme');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        updateIcons();
      });

      // Listen for system theme changes only if no saved preference
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (localStorage.getItem('theme') === null) {
          if (e.matches) {
            document.body.classList.add('dark-theme');
            document.documentElement.classList.add('dark-theme');
          } else {
            document.body.classList.remove('dark-theme');
            document.documentElement.classList.remove('dark-theme');
          }
          updateIcons();
        }
      });
    });
  </script>
</body>
</html>
